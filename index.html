<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Turbo Tuga — Promo Game</title>
<link rel="icon" href="data:,">
<style>
  html,body {height:100%;margin:0;background:#071127;font-family:Inter, Arial, Helvetica, sans-serif;}
  #game-container {width:100%;height:100vh;display:flex;align-items:center;justify-content:center;overflow:hidden}
  canvas {display:block}
  .ui { position: fixed; left: 12px; top: 12px; color:#fff; font-weight:700; text-shadow:0 1px 0 #000; z-index:1000}
  .ui .score { font-size:18px; }
  .ui .level { font-size:14px; opacity:0.95; margin-top:6px; }
  .topright { position: fixed; right: 12px; top: 12px; color:#fff; z-index:1000; text-align:right }
  .center-msg { position: fixed; left:50%; top:50%; transform:translate(-50%,-50%); color:#fff; text-align:center; display:none; z-index:1001 }
  .btn { background:#1e8a3d; padding:12px 18px; border-radius:10px; cursor:pointer; display:inline-block; margin-top:12px; font-weight:800; box-shadow: 0 6px 0 #0f5b26; }
  .btn:active { transform: translateY(2px); box-shadow: 0 4px 0 #0f5b26; }
  #walletInput { padding:10px; font-size:16px; width:320px; border-radius:8px; border:2px solid rgba(255,255,255,0.12); }
  .small { font-size:13px; opacity:0.95; }
  #distributeBtn { background:#ff9900; box-shadow: 0 6px 0 #b26b00; color:#111; }
  @media (max-width:700px) {
    #walletInput { width:82vw; }
    .btn { padding:10px 14px; }
  }
</style>
</head>
<body>
<div id="game-container"></div>

<div class="ui">
  <div class="score">Coins: <span id="coins">0</span></div>
  <div class="level">Level: <span id="level">1</span></div>
</div>

<div class="topright">
  <div class="score">Lives: <span id="lives">3</span></div>
  <div class="small" style="margin-top:8px">Token: <strong>TURBO-TUGA</strong></div>
</div>

<div class="center-msg" id="centerMsg">
  <div id="centerText"></div>
  <div style="margin-top:12px">
    <div class="btn" id="restartBtn">Restart</div>
  </div>
</div>

<!-- Phaser embutido -->
<script id="phaser-lib">
/* =============================
   PASTE phaser.min.js HERE !!!
   (Open phaser.min.js in editor,
   copy all, and paste here)
   ============================= */
</script>

<!-- Game code -->
<script>
const GAME_WIDTH = 960;
const GAME_HEIGHT = 540;

class BootScene extends Phaser.Scene {
  constructor(){ super('BootScene'); }
  create(){
    this.createBackgroundTexture();
    this.createCoinTexture();
    this.createTurtleFrames();
    this.scene.start('TitleScene');
  }
  createBackgroundTexture(){
    const rt = this.textures.createCanvas('bg', GAME_WIDTH, GAME_HEIGHT);
    const ctx = rt.getContext();
    const grad = ctx.createLinearGradient(0,0,0,GAME_HEIGHT);
    grad.addColorStop(0, '#7AD3FF');
    grad.addColorStop(0.6, '#66C2FF');
    grad.addColorStop(1, '#80D28A');
    ctx.fillStyle = grad;
    ctx.fillRect(0,0,GAME_WIDTH,GAME_HEIGHT);
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    for(let i=0;i<6;i++){
      let cx = 60 + i*160 + (i%2)*40;
      let cy = 70 + (i%3)*30;
      ctx.beginPath(); ctx.ellipse(cx, cy, 36, 24, 0, 0, Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.ellipse(cx+30, cy+6, 34, 22, 0, 0, Math.PI*2); ctx.fill();
    }
    ctx.fillStyle = '#3A9A63';
    ctx.beginPath();
    ctx.moveTo(0,GAME_HEIGHT*0.6);
    ctx.lineTo(180,GAME_HEIGHT*0.35);
    ctx.lineTo(320,GAME_HEIGHT*0.62);
    ctx.lineTo(500,GAME_HEIGHT*0.4);
    ctx.lineTo(760,GAME_HEIGHT*0.62);
    ctx.lineTo(GAME_WIDTH,GAME_HEIGHT*0.48);
    ctx.lineTo(GAME_WIDTH,GAME_HEIGHT);
    ctx.lineTo(0,GAME_HEIGHT);
    ctx.closePath();
    ctx.fill();
    this.textures.addCanvas('bg', rt.canvas);
  }
  createCoinTexture(){
    const g = this.make.graphics({x:0,y:0,add:false});
    g.fillStyle(0xFFCC00,1);
    g.fillCircle(24,24,20);
    g.lineStyle(4, 0xD79400, 1);
    g.strokeCircle(24,24,20);
    g.fillStyle(0xE6AA00,1);
    g.fillRect(10,18,24,8);
    g.generateTexture('coin',48,48);
    g.destroy();
  }
  createTurtleFrames(){
    const width = 120, height = 120;
    const rt = this.textures.createCanvas('turtle_spritesheet', width*3, height);
    const ctx = rt.getContext();
    for(let f=0; f<3; f++){
      const ox = f*width;
      ctx.clearRect(ox,0,width,height);
      ctx.fillStyle = '#49C05A';
      ctx.beginPath();
      ctx.ellipse(ox+60, 70, 36, 28, 0, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#8B4E24';
      ctx.beginPath(); ctx.ellipse(ox+60, 45, 44, 30, 0, 0, Math.PI*2); ctx.fill();
      ctx.fillStyle = '#C96F1B'; ctx.fillRect(ox+32,30,56,16);
      ctx.fillStyle = '#E33A2B';
      ctx.beginPath(); ctx.arc(ox+72, 28, 22, Math.PI*1.1, Math.PI*2.1); ctx.fill();
      ctx.fillStyle = '#0B2B3A'; ctx.fillRect(ox+56,23,28,10);
      ctx.fillStyle = '#072'; ctx.beginPath(); ctx.arc(ox+48, 32, 4, 0, Math.PI*2); ctx.fill();
    }
    this.textures.addCanvas('turtle_spritesheet', rt.canvas);
  }
}

class TitleScene extends Phaser.Scene {
  constructor(){ super('TitleScene'); }
  create(){
    this.add.image(0,0,'bg').setOrigin(0).setDisplaySize(GAME_WIDTH,GAME_HEIGHT);
    this.add.text(GAME_WIDTH/2, 70, 'TURBO TUGA', { fontSize:'56px', color:'#ffd166' }).setOrigin(0.5);
    this.add.text(GAME_WIDTH/2, 130, 'Collect coins to win TURBO-TUGA tokens!', { fontSize:'20px', color:'#fff' }).setOrigin(0.5);
    const walletInput = document.createElement('input');
    walletInput.id = 'walletInput';
    walletInput.type = 'text';
    walletInput.placeholder = 'Enter Solana wallet address';
    walletInput.style.position = 'fixed';
    walletInput.style.left = '50%'; walletInput.style.top = '190px'; walletInput.style.transform = 'translateX(-50%)';
    document.body.appendChild(walletInput);
    const startBtn = this.add.text(GAME_WIDTH/2, GAME_HEIGHT - 110, 'START GAME',
      { fontSize:'28px', backgroundColor:'#1e8a3d', padding:12, color:'#fff' }).setOrigin(0.5).setInteractive();
    startBtn.on('pointerup', () => {
      const addr = walletInput.value.trim();
      if(!addr) {
        if(!confirm("No wallet entered. You can still play, but you won't be eligible for rewards. Start anyway?")) return;
      }
      sessionStorage.setItem('tuga_wallet', addr || '');
      walletInput.remove();
      this.scene.start('GameScene', { level: 1, wallet: addr || '' });
    });
  }
}

class GameScene extends Phaser.Scene {
  constructor(){ super('GameScene'); }
  init(data){ this.wallet = data.wallet; this.level=1; this.lives=3; this.coinsCollected=0; this.isGameOver=false; }
  create(){
    this.add.image(0,0,'bg').setOrigin(0).setDisplaySize(GAME_WIDTH,GAME_HEIGHT);
    this.physics.world.setBounds(0,0,6000,GAME_HEIGHT);
    this.cameras.main.setBounds(0,0,6000,GAME_HEIGHT);
    this.platforms=this.physics.add.staticGroup();
    for(let i=0;i<60;i++){ let rect=this.add.rectangle(i*120,GAME_HEIGHT-72,120,120,0x1f9a3a).setOrigin(0,0); this.physics.add.existing(rect,true); this.platforms.add(rect); }
    if(!this.textures.exists('spike')){ const g=this.add.graphics(); g.fillStyle(0x888888,1); g.fillTriangle(0,32,16,0,32,32); g.generateTexture('spike',32,32); g.destroy(); }
    this.player=this.physics.add.sprite(140,GAME_HEIGHT-160,'turtle_spritesheet').setScale(0.9);
    this.physics.add.collider(this.player,this.platforms);
    this.coins=this.physics.add.group(); for(let i=0;i<40;i++){ let c=this.coins.create(400+i*150,GAME_HEIGHT-Phaser.Math.Between(150,260),'coin'); c.body.setAllowGravity(false);}
    this.physics.add.overlap(this.player,this.coins,(p,c)=>{c.disableBody(true,true);this.collectCoin();});
    this.spikes=this.physics.add.group({allowGravity:false,immovable:true}); for(let i=0;i<25;i++){ this.spikes.create(600+i*200,GAME_HEIGHT-84,'spike'); }
    this.physics.add.collider(this.player,this.spikes,()=>this.hitSpike(),null,this);
    this.cameras.main.startFollow(this.player,true,0.1,0.1);
    this.cursors=this.input.keyboard.createCursorKeys(); this.keyA=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A); this.keyD=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D); this.keyW=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W);
  }
  collectCoin(){ this.coinsCollected++; document.getElementById('coins').innerText=this.coinsCollected; if(this.coinsCollected%15===0){this.level++; document.getElementById('level').innerText=this.level;} }
  hitSpike(){ this.lives--; document.getElementById('lives').innerText=this.lives; if(this.lives<=0)this.endGame(); }
  endGame(){ this.isGameOver=true; document.getElementById('centerText').innerHTML=`<h2>GAME OVER</h2><p>Wallet: ${this.wallet||'—'}</p><p>Coins: ${this.coinsCollected}</p>`; document.getElementById('centerMsg').style.display='block'; this.physics.pause(); document.getElementById('restartBtn').onclick=()=>location.reload(); }
  update(){ if(this.isGameOver)return; let vx=0; if(this.cursors.left.isDown||this.keyA.isDown)vx=-220; else if(this.cursors.right.isDown||this.keyD.isDown)vx=220; if(vx===0)vx=120; this.player.setVelocityX(vx); if((this.cursors.up.isDown||this.keyW.isDown)&&this.player.body.onFloor())this.player.setVelocityY(-480); }
}

const config={ type:Phaser.AUTO,width:GAME_WIDTH,height:GAME_HEIGHT,parent:'game-container',physics:{default:'arcade',arcade:{gravity:{y:1000},debug:false}},scene:[BootScene,TitleScene,GameScene]};
window.addEventListener('load',()=>{ new Phaser.Game(config); });
</script>
</body>
</html>
